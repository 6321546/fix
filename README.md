# プログラミング試験
この度はプログラミング試験を受けさせていただいてありがとうございます。

設問4まで実装致い、こちらが用意したテストデータでは想定通りに機能しています。
## ファイルについて
Qn(n:1-4)のファイルにそれぞれ解答プログラムansar1.py、ansar2.py、ansar3.py、ansar4.pyが入っています。テストデータと実行結果のスクリーンショットも入っています。

## 使用言語
Python3.8.3

## 使用ライブラリ
os : オペレーティングシステムインターフェース  
re : 正規表現操作  
datetime : 基本的な日付型及び時間型  
ipaddress : IPv4/IPv6 操作ライブラリ(Q4.のみ)  
typing : 型ヒントのサポート(Q4.のみ)  

## データの想定
ログファイルの下に行けば行くほど現在以上の時間になっていることを想定しています。また、日付やping値などにも誤りがないことを想定しています。

## 基本設計
どのプログラムも1行づつログファイルからデータを読み込み、正規表現によるパターンマッチを行い必要な情報を得ています。
各プログラムごとに故障期間を出力する関数ReportTime()と、アドレスaddres、故障開始時間のリストsTime、故障終了時間のリストeTime、自身故障中なのかどうかを表すstateをデータとして持つようなclass:Serverを定義しています。

主なプログラムの流れ  
(1). class:Serverを要素として持つリスト内に該当アドレスを持つサーバーがあるかどうかを調べる。  
(2). なければ追加を行う。  
(3). (1)で見つけたサーバー、もしくは、(2)で追加したサーバーに対してping値に対応して処理を行う。  
(4). サーバーが故障状態なのかどうか判断し、クラスのリストに時間を記録する。  
(5). (1)-(4)をファイルが読み終わるまで行う。  
(6). 結果を表示。  

以下では解説として  
・前述したもの以外にclass:Serverが持っている値  
・(3)のpingの値に対応した処理  
・(4)のサーバーの故障状態の判断と時間の記録の仕方について述べる  
・その他注意事項など  
について述べる

## 実行方法
ログファイルもしくはテストデータのファイルをansar.pyと同じディレクトリにおいてansar.pyを実行。  
実行すると読み込むファイル名、その他必要なパラメータの順に標準入力を行う。

## A1.
### 前述したもの以外にclass:Serverが持っている値
count:タイムアウトの連続回数.
### pingの値に対応した処理
'-'  : countの値を1にする:関数addcount()  
other: countの値を0にする:関数resetcount() 
### サーバーの故障状態の判断と時間の記録の仕方:関数isBreak(time)
countの値が1でstateがFalseなら開始時間のリストsTimeに時間を追加する。その後stateをTrueにする。  
countの値が0でstateがTrueなら終了時間のリストeTimeに時間を記録する。その後stateをFalseにする。  
上記以外の条件では何もしない。

## A2.
### 前述したもの以外にclass:Serverが持っている値
count:タイムアウトの連続回数  
N:故障の閾値  
### pingの値に対応した処理
'-'  : countの値がN以下ならcountの値を1増加させる:関数addcount()  
other: countの値を0にする:関数resetcount()  
### サーバーの故障状態の判断と時間の記録の仕方:関数isBreak(time)
countの値がNでstateがFalseなら開始時間のリストsTimeに時間を追加する。その後stateをTrueにする。  
countの値が0でstateがTrueなら終了時間のリストeTimeに時間を記録する。その後stateをFalseにする。  
上記以外の条件では何もしない。

## A3.
### タイムアウトの扱いについて
タイムアウトした場合は応答受付時間内に返答がないので、これも過負荷状態によるものと考え、ping値を40000として与え計算を行っている。このping値についてはwindowsコマンドのpingコマンドのデフォルトタイムアウト値を参考としています。
### 平均応答時間の計算について
直近の応答がM回より小さい場合は、その数で平均をとり平均応答時間を計算しています。
### 前述したもの以外にclass:Serverが持っている値
M:計算する直近の回数  
T:平均応答時間の閾値  
PingMemory:直近M回のping値を要素として持つリスト  
index:PingMemoryのインデックス  
### pingの値に対応した処理:関数addping(ping)
PingMemoryの中で一番古いping値が格納されているインデックスへ新しいping値を格納する。
### サーバーの故障状態の判断と時間の記録の仕方
平均応答時間がTを超えていてstateがFalseなら開始時間のリストsTimeに時間を追加する。その後stateをTrueにする。  
平均応答時間がT以下でstateがTrueなら終了時間のリストeTimeに時間を記録する。その後stateをTrueにする。  
上記以外の条件では何もしない。

## A4.
### プログラムについて
この問題の回答プログラムのみ主な流れが少し異なる。また、class:Serverの他にclass:SubNetworkが定義されている。  
class:Subnetworkはclass:Serverと同様に故障期間を出力する関数ReportTime()と、ネットワークアドレスnetwork、故障開始時間のリストsTime、故障終了時間のリストeTime、自身故障中なのかどうかを表すstateを持っています。  
class:ServerについてはA2.と同じものです。

主なプログラムの流れ  
(1). class:SubNetworkを要素として持つリスト内に該当ネットワークアドレスを持つネットワークがあるかどうかを調べる。  
(2). なければリストにネットワークの追加を行う。  
(3). (1)で見つけたネットワーク、もしくは、(2)で追加したネットワークが持つサーバーのリストに対して該当アドレスを持つサーバーがあるかを調べる。  
(4). なければ該当ネットワークが持つサーバーのリストに新しいサーバー(class:Server)の追加を行う。  
(5). (3)で見つけたサーバー、もしくは、(4)で追加したサーバーが故障状態なのかどうか判断し、サーバーのリストに時間を記録する。  
(6). 全てのサーバーが故障状態なのかどうか判断し、クラス(SubNetwork)のリストに時間を記録する。  
(7). (1)-(4)をファイルが読み終わるまで行う。  
(8). 結果を表示。  
### 表示される結果について
データを全て読み込んだ後に確認できる同一ネットワーク上の全てのサーバーが故障していた場合のみネットワークが故障したとみなしています。  
### 前述したもの以外にclass:Subnetworkが持っている値
severs: class:Serverのリスト
### pingの値に対応した処理
該当Subnetworkのもつサーバーのリストに対してA2.と同じ処理を行なっている。
### ネットワークの故障状態の判断と時間の記録の仕方
サーバーのリストが持つサーバーの状態(class:Serverのstate)が全て故障していて、stateがFalseなら開始時間のリストsTimeに時間を追加する。その後stateをTrueにする。  
サーバーのリストが持つサーバーの状態(class:Serverのstate)が1つ以上正常で、stateがTrueなら終了時間のリストeTimeに時間を記録する。その後stateをFalseにする。  
上記以外の条件では何もしない。
